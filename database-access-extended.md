# Database Access Science Case: "Start with some reasonable/common queries in the platform, then realize you need something esoteric"

Geralt is a gruff but knowledgable astronomer who is a member of a Roman GO team called WITCHER ("Wide Imaging To CHase Exploded Resolved stars"). Geralt has taken on the task of collecting all the relevant WITCHER data into a shared catalog that the rest of the team can use as sort of an internal "data release".  Geralt is fairly knowledgeable in database queries and the like, as he has worked on SDSS data, but is relatively new to Roman.  He does like working in Jupyter notebooks, but is pretty picky about how his interface looks - he favors a special theme that highlights relevant information for him that is called "silver-sword", which is pip-installable.  Fortunately he manages to get it to work so he is willing to try using the Roman Science Platform for this work.

Geralt starts similar to the (base case)[database-access-base.md], which quickly familiarizes him with the schema used for Roman catalogs. He does an `astroquery.mast` search on the WITCHER program id, and then can easily use that to do catalog searches for the WITCHER-specific fields. That is, the catalog searches should simply work with the exposure lists that come from the data product searches.  With these catalogs in hand, he starts doing a variety of tests to make sure the catalogs are good enough to use for their team's science cases.  Most of it is excellent-quality, because the fields are similar to a typical Roman field and hence the base pipeline works just fine.  However, he notices there's a set of targets that are outliers and seem to be spoiling a lot of the analysis. He mutters to himself "those catalogs need to overcome the vanity and pride of being different", so he sets out on a Path to figure out what is going on with those outliers.

First Geralt takes a look at the sky viewer image mosaic (see the sky-viewer use cases for examples of how he does that), but doesn't see anything particularly odd other than perhaps a bit of an odd blur that doesn't really tell him much.  He sighs and growls a bit in irritation.  But then he remembers the schema browser.  He finds instructions that clearly show how to use it in this setting: from his already-downloaded tables, there is a way in Python to ask for the relevant schema.  This pops up a side-panel with documentation, and he quickly sees that one of the columns is a reference to *another* table that contains some ancillary information that usually isn't needed but contains a lot of flags about how guiding preformed in that observation. Geralt has almost supernaturally-good senses around detecting oddities in data, so he immediately suspects this is related.  He follows the documentation to the ancillary table, and by comparing that to the relevant `astroquery` search function he used at the start, he sees that he just needs to change the table name to get the ancillary data for these objects, without needing to do any by-hand SQL joins. Using the original catalog to split the dataset into a "good" and "bad" set, he compares the ancillary data between the two sets.  It quickly becomes clear that in the "bad" data, there is a flag that is consistently set in the guiding column.  Going back to the schema browser, Geralt sees that this flag is a specific kind of guiding failure, and confined to a few specific, but key field for the WITCHER survey.

With this information in hand, Geralt tells the other WITCHERS, who have just gathered for their winter meeting at the conference center Kaer Morhen, about this monster lurking in their own data. They quickly organize together to figure out how to defeat it, allowing Geralt to complete the data relase. As the conference conclues, the WITCHERS, including Geralt, scatter on their never ending quest to protect astronomy from such data monsters.


## Notes

* I don't really know much about how Roman plans to do guiding.  I'm just assuming its somewhat akin to HST and JWST, but I welcome changes if something is dramatically different from what it says here.
* Also note the element above about theming.  While it is not strictly related to this science case (and might appear to just be a joke), it is an important element to consider for platform flows: that a user may want to see similar layouts across multiple workflows/platforms and need the ability to do things like this. Note that there is some debate whether this is important to prioritize.  The intent here is to *allow* this, as it is already possiible in Jupyter, but not actually put significant development work into making it *easy*.  That could come after launch, or not, depending on the amount the community seems to care.
* NOTE ON FUNCTIONALITY: "from his already-downloaded tables, there is a way in Python to ask for the relevant schema." --> the schema must be included along with the return table after running, e.g., an astroquery.mast Catalog query against a Roman table.  Perhaps consider a "pretty print" pprint() option?  Science use case mentions following links/references to ancillary tables, probably best done in the schema browser.
* The workflow of going from the WITCHER pid search to catalog searches needs more clarification: the idea is that it should be easy to get the product lists and have something (probably astropyquery.mast.Catalog?) be able to take those in and know how to search within the region for the observation.  "region for the observation" is context-dependent: it could autmoatically just get the s_region and use that, which is probably the most natural thing, but Geralt might instead want to do a cone search around the center coordinate but *larger* than the actual observation. In that case he has to do that himself, because it's no longer clear what the search really is, and so it's not reasonable to expect the code to just guess you want something other than the s_region.
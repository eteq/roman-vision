# Sky Viewer Science Case: â€œFind an object observed by Roman and identify other MAST data overlapping with it (+accessing catalogs via astroquery in platform)"


## The novice user case 

Egwene is an astronomer but a novice at using Roman. She is looking for certain patterns of observations that signify gaps in the distribution of high redshift galaxies (or "Dark Ones"), in a well-studied field (e.g. an HST deep field or similar).  She hears from someone at a conference that some newly-released Roman data covers the area of the sky she has been studying, and this may help her search as it uses information on the shapes of galaxies that Roman is particularly well-suited for. She begins the same way as either of the the [base cases](sky-viewer-base.md), via a search for her field in the sky viewer. The next thing she needs to know, though, is spectroscopic coverage.  She knows there is a lot of JWST NIRSpec data, but she wants to understand how much the NIRSpec data overlaps with the Roman data. She thus needs a way, within the MAST web site, to search for JWST data that overlaps with the roman images.  She enters a mission-mast like search interface to do this, sub-selecting specific modes of JWST NIRSpec spectroscopy and exposure times that are long enough to get redshifts for the galaxies in the field.  These then appear on the skyviewer as outlies over the Roman base image.  She quickly sees that there is a gap in NIRSpec coverage right over her most promising candidate gap (which she just calls "The Dark One"), but she can tell from the image quality that if she can get spectroscopy there it will be by far the best data set yet on this scientific topic. She decides to channel the One Power of an astronomer: the ability to ask for more data - i.e., writing a JWST proposal.

## The platform-oriented use case

To help prepare for the proposal, Egwene calls her mentor, Moiraine, who is very interested in Dark Ones and has a number of theories about them (which for some reason she calls "prophecies"). Moiraine is very experienced with JWST and Roman, which means she knows sometimes the science platform is a good way to get things done. To properly prepare the proposal, Moiraine and Egwene need to know which targets have been already observed in some of the nearby JWST/NIRSpec observations.  But to ascertain this it's not good enough to just show the targets they found in MAST, they actually need to do some quick-and-dirty analysis of the spectra themselves, cross-matched with the sources identified in the Roman images.  Moiraine knows that all of these data are available in the science platform, and has used them before, so she knows to immediately start up the platform.  

She starts up the platform, but realizes she doesn't know how to interact with the sky viewer in the platform.  From a quick glance at the example notebooks, she sees that there is one that demonstrates basic interaction with the sky viewer. She starts from that notebook and quickly figures out how to display the sky viewer on one side of her screen with the notebook on the other, with the notebook controlling the sky viewer. She's already an experienced Python user so she knows that to get the JWST data she needs she fires up astroquery and does a search for JWST NIRSpec level 3 data (i.e. specific spectra) and begins downloading them.  To her surprise, it's nearly instantaneous, because the data are all in the cloud so "downloading" is just opening connections to cloud data resources. She's impressed at how efficiently and quickly this all comes up - she spends a lot of time not in her academic ivory (White?) tower office, traveling to do outreach, so it's really useful for her to be able to do this from a dodgy hotel internet connection on an under-powered laptop.

There's a feature at a specific redshift near the Dark One (which is inexplicably called "Shayol Ghul" - must be some old language or something?), so she know the wavelength where the spectra need to be good enough. With the JWST spectra in hand, she now does a standard spectroscopic analysis task of measuring the S/N in a specific wavelength window that is critical for getting redshifts near The Dark One. She now needs to show on the sky viewer where those spectra are. The example notebook she's working from shows exactly how to mark data from tables on the sky viewer using astropy Table or pandas DataFrames, so she just follows that example using the coordinates from the JWST observation metadata.  It clearly shows some of the key targets that the Roman imaging reveals have insufficient spectra.  So she then uses astroquery to do a catalog search of the Roman/WFI data near this field.  She uses the same Python code that rendered the JWST spectra markers, and it shows the (thousands of) sources that match her possible-target cuts.

She now sees exactly where they need to target the JWST proposal to close the "Bore" (as they call the gap in the data) around the Dark One. She saves her catalogs in the platform using standard Python commands, and downloads it to her laptop via the typical JupyterHub way of downloading files.  She then sends that to Egwene with the targetting coordinates, which is what Egwene needs to write a proposal. When it is successful and they get the data, it clearly confirms one of Moiraine predictions that certain new-found stars called "dragons" might start forming. She says: "The prophecy has been fulfilled. The Dragon is Reborn."

### Alternative ending

Instead of saving the catalogs and downloading them, Moiraine could and perhaps even should instead share the catalogs with Egwene via platform group mechanisms.  However, for some users, if all they need is a target list one time, it's overkill for them to use that functionality.  So we should allow *both* workflows (primarily because the download-from-jupyter version is already built into Jupyter anyway).

## Notes
* It is not really clear that the planned catalogs will actually satisfy this use case - it's hard to know for sure until real data comes in.  But for the purposes of planning, we'll just assume they are good enough for this specific problem.  If not, the [catalog-search](sky-viewer-catalog-search.md) use case would also be needed to do photometry, etc.
* Would an example of the notebook for the platform-oriented case be helpful here?  If so, I (EJT) can make that. YES
* There is a Plan B possible for this use case for if the sky viewer cannot be started without any data, which is to say "do a CAOM search to get all available Roman and JWST observations within your field of interest.  Then load those footprints into the Sky Viewer by passing those results to the Sky Viewer to load in a cell within your notebook."
* NOTE ON FUNCTIONALITY: "She starts from that notebook and quickly figures out how to display the sky viewer on one side of her screen with the notebook on the other, with the notebook controlling the sky viewer." --> This is an immediate thing that needs to be factored in, since the initial plan was to have Sky Viewer working in a notebook cell as part of a notebook, rather than having Sky Viewer and an analysis notebook sharing RSP screen real estate. Even now, there is the ability to have multiple notebooks open, but as tabs with only one displayed at a time. Even if the Sky Viewer is running in its own notebook, does the science use case require the RSP be able to run two notebooks side-by-side within the RSP, sharing screen real-estate, window focus, run states, etc?  Maybe RSP does this already and I haven't seen it yet?  If not, then one is running a (desktop?) version of Sky Viewer on the RSP, but in a window alongside the window that supports the current window+tabs containing notebooks and README files, which I also think would need to be developed and tested?
* While not strictly necessary for the above workflow, allowing a quick "center on candidate" option that could be navigated through via tab or arrow keys is a desired feature.
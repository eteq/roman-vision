# Image Viewer Science Case: Do PSF photometry from the platform on a specific Roman image subset

This case follows from (the aperture photometry science case)[image-viewer-aperture-photometry.md].  There exist similar science cases where a scientist would likely know right away they have to go straight to PSF photometry, so not all realistic PSF photometry cases would start as aperture photometry.  For this case, though, we are doing that because it requires less explanatiuon of the background.

While the batch processing has gotten them most of the way there, when Obi-wan, Luke, and Han look at the photometry results they quickly see that a sub-set of the results don't really make sense.  They all together look at the problematic fields and quickly see: these are more crowded clusters where aperture photometry doesn't work well, they need PSF-fitting photometry in these areas.  They wonder what to do for a little, while, but while thinking about idea, they hear someone coming down the hall: it's the other astro faculty member, Professor Tarkin.  He points out to them that the department seminar is about to start, so they are caught in his tractor beam that pulls them into the seminar room.  There, they notice Tarkin's student, Leia. They recall that Tarkin and his postdoc Vader have not-so-great reputation as a rather cruel undergraduate research advisor. Indeed, as the seminar plays out, Leia asks a remarkably good question about... PSF photometry!  But Vader and Tarkin ruthlessly quash her question and then edge her out when she expresses a desire to have dinner with the seminar speaker.  Obi-wan, Luke, and Han take it on themslves to rescue Leia by asking her to help with the PSF photometry in their star cluster project.  Leia agrees, albiet in a brisque way (she tells Luke "aren't you a bit short on astro knowledge to be a cluster trooper?").

Leia follows on in the science platform from Luke and Han's notebooks.  She gets the papermill outputs for one of the crowded clusters from the group space on the platform, and builds off of that. PSF photometry is also available in `photutils`, which she uses but also has her own custom code that she has to upload to the platform. Because of all this custom code, she only needs the image viewer to visualize the Roman single-exposure images that match the mosaics, and compare that and the PSF-subtracted difference images.  She also needs to use `webbpsf`, a separate Python package that requires significant data downloads that aren't necessarily baked into the platform.  Fortunately, there is a docker image in the platform that comes with webbpsf already build and ready for this use case, so she simply switches to that docker image for her work, isntead of the standard roman docker image the others were using.  With this, she tunes the PSF photometry parameters to do an excellent job in the specific conditions of this one cluster. It looks a lot better!  But now she needs to run it on the other 10 or so clusters that are crowded enough to need PSF photometry.  This takes a lot of semi-automated steps where she runs the psf code, loads the subtracted and un-subtracted images into imviz, centers on a specific spot using Python code, but then uses imviz's interactive blink and stretch capabilities to actually inspect the output.  Then, as needed she repeats with a new set of parameters. Leia is very determined to do this her way given she is a bit of a rebel, though, and succeeds in stellar fashion.  Together, Luke, Leia, and Han manage to clean up the whole dataset, even though Obi-Wan ends up getting trapped into a side project by Vader and not able to help them with the analysis.

In the end they all go together to present their spectacular results at a conference in a place called Yavin IV. There's a great although oddly martial ceremony at the end to celebrate their phenomenal presentations.

## Notes

* NOTE ON FUNCTIONALITY: A key step in the analysis flow here is to create difference images while iterating on the PSF fitting, upload them and the original into ImViz, and then use ImViz blink and stretch tools to compare and assess. It might be good to have some example notebook illustrating this.
